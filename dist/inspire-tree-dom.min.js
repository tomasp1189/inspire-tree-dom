/* Inspire Tree DOM
 * @version 0.1.0
 * https://github.com/helion3/inspire-tree-dom
 * @copyright Copyright 2015 Helion3, and other contributors
 * @license Licensed under MIT
 *          see https://github.com/helion3/inspire-tree-dom/blob/master/LICENSE
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("lodash"),require("inspire-tree")):"function"==typeof define&&define.amd?define(["lodash","inspire-tree"],t):e.InspireTreeDOM=t(e._,e.InspireTree)}(this,function(e,t){"use strict";t=t&&t.hasOwnProperty("default")?t.default:t;var n="$NO_OP",o="a runtime error occured! Use Inferno in development environment to find the error.",r=Array.isArray;function i(e){var t=typeof e;return"string"===t||"number"===t}function a(e){return p(e)||u(e)}function s(e){return u(e)||!1===e||function(e){return!0===e}(e)||p(e)}function l(e){return"function"==typeof e}function d(e){return"string"==typeof e}function c(e){return"number"==typeof e}function u(e){return null===e}function p(e){return void 0===e}function f(e){return void 0!==e}function h(e,t){var n={};if(e)for(var o in e)n[o]=e[o];if(t)for(var r in t)n[r]=t[r];return n}var v="$";function g(e,t,n,o,r,i,a,s){return{childFlags:e,children:t,className:n,dom:null,flags:o,key:void 0===r?null:r,parentVNode:null,props:void 0===i?null:i,ref:void 0===a?null:a,type:s}}function m(e,t,n,o,r,i,a,s){var l=void 0===r?1:r,d=g(l,o,n,e,a,i,s,t),c=w.createVNode;return"function"==typeof c&&c(d),0===l&&x(d,d.children),d}function y(e,t,n,o,r){(2&e)>0&&(e=f(t.prototype)&&l(t.prototype.render)?4:8);var i=t.defaultProps;if(!a(i))for(var s in n||(n={}),i)p(n[s])&&(n[s]=i[s]);if((8&e)>0){var d=t.defaultHooks;if(!a(d))if(r)for(var c in d)p(r[c])&&(r[c]=d[c]);else r=d}var u=g(1,null,null,e,o,n,r,t),h=w.createVNode;return l(h)&&h(u),u}function b(e,t){return g(1,a(e)?"":e,null,16,t,null,null,null)}function k(e){var t=e.props;if(t){var n=e.flags;481&n&&(f(t.children)&&a(e.children)&&x(e,t.children),f(t.className)&&(e.className=t.className||null,t.className=void 0)),f(t.key)&&(e.key=t.key,t.key=void 0),f(t.ref)&&(e.ref=8&n?h(e.ref,t.ref):t.ref,t.ref=void 0)}return e}function C(e){var t,n=e.flags;if(14&n){var o,r=e.props;if(!u(r))for(var i in o={},r)o[i]=r[i];t=y(n,e.type,o,e.key,e.ref)}else if(481&n){var a=e.children;t=m(n,e.type,e.className,a,0,e.props,e.key,e.ref)}else 16&n?t=b(e.children,e.key):1024&n&&(t=e);return t}function D(){return b("",null)}function $(e,t,n,o){for(var a=e.length;n<a;n++){var l=e[n];if(!s(l)){var c=o+v+n;if(r(l))$(l,t,0,c);else{if(i(l))l=b(l,c);else{var p=l.key,f=d(p)&&p[0]===v;u(l.dom)&&!f||(l=C(l)),u(p)||f?l.key=c:l.key=o+p}t.push(l)}}}}function x(e,t){var n,o=1;if(s(t))n=t;else if(d(t))o=2,n=b(t);else if(c(t))o=2,n=b(t+"");else if(r(t)){var a=t.length;if(0===a)n=null,o=1;else{(Object.isFrozen(t)||!0===t.$)&&(t=t.slice()),o=8;for(var l=0;l<a;l++){var p=t[l];if(s(p)||r(p)){$(t,n=n||t.slice(0,l),l,"");break}if(i(p))(n=n||t.slice(0,l)).push(b(p,v+l));else{var f=p.key,h=u(p.dom),g=u(f),m=!g&&f[0]===v;!h||g||m?(n=n||t.slice(0,l),h&&!m||(p=C(p)),(g||m)&&(p.key=v+l),n.push(p)):n&&n.push(p)}}(n=n||t).$=!0}}else n=t,u(t.dom)||(n=C(t)),o=2;return e.children=n,e.childFlags=o,e}var w={afterMount:null,afterRender:null,afterUpdate:null,beforeRender:null,beforeUnmount:null,createVNode:null,roots:[]},N="http://www.w3.org/1999/xlink",S="http://www.w3.org/XML/1998/namespace",P="http://www.w3.org/2000/svg",O={"xlink:actuate":N,"xlink:arcrole":N,"xlink:href":N,"xlink:role":N,"xlink:show":N,"xlink:title":N,"xlink:type":N,"xml:base":S,"xml:lang":S,"xml:space":S},T={},L=[];function U(e,t){e.appendChild(t)}function M(e,t,n){a(n)?U(e,t):e.insertBefore(t,n)}function E(e,t,n){e.replaceChild(t,n)}function I(e){for(var t;void 0!==(t=e.shift());)t()}var F={},A={};function V(e,t,n){var o=F[e],r=n.$EV;t?(o||(A[e]=function(e){var t=function(t){var n=t.type,o="click"===n||"dblclick"===n;if(o&&0!==t.button)return t.preventDefault(),t.stopPropagation(),!1;t.stopPropagation=R;var r={dom:document};try{Object.defineProperty(t,"currentTarget",{configurable:!0,get:function(){return r.dom}})}catch(e){}!function(e,t,n,o,r){var i=t;for(;!u(i);){if(n&&i.disabled)return;var a=i.$EV;if(a){var s=a[o];if(s&&(r.dom=i,s.event?s.event(s.data,e):s(e),e.cancelBubble))return}i=i.parentNode}}(t,t.target,o,e,r)};return document.addEventListener(j(e),t),t}(e),F[e]=0),r||(r=n.$EV={}),r[e]||F[e]++,r[e]=t):r&&r[e]&&(F[e]--,1===o&&(document.removeEventListener(j(e),A[e]),A[e]=null),r[e]=t)}function j(e){return e.substr(2).toLowerCase()}function R(){this.cancelBubble=!0,this.stopImmediatePropagation()}function B(e,t){var n=document.createElement("i");return n.innerHTML=t,n.innerHTML===e.innerHTML}function W(e,t,n){if(e[t]){var o=e[t];o.event?o.event(o.data,n):o(n)}else{var r=t.toLowerCase();e[r]&&e[r](n)}}function H(e,t){var n=function(n){n.stopPropagation();var o=this.$V;if(o){var r=o.props||T,i=o.dom;if(d(e))W(r,e,n);else for(var a=0;a<e.length;a++)W(r,e[a],n);if(l(t)){var s=this.$V,c=s.props||T;t(c,i,!1,s)}}};return Object.defineProperty(n,"wrapped",{configurable:!1,enumerable:!1,value:!0,writable:!1}),n}function q(e){return"checkbox"===e||"radio"===e}var K=H("onInput",z),X=H(["onClick","onChange"],z);function Q(e){e.stopPropagation()}function z(e,t){var n=e.type,o=e.value,r=e.checked,i=e.multiple,s=e.defaultValue,l=!a(o);n&&n!==t.type&&t.setAttribute("type",n),a(i)||i===t.multiple||(t.multiple=i),a(s)||l||(t.defaultValue=s+""),q(n)?(l&&(t.value=o),a(r)||(t.checked=r)):l&&t.value!==o?(t.defaultValue=o,t.value=o):a(r)||(t.checked=r)}function G(e,t){if("optgroup"===e.type){var n=e.children,o=e.childFlags;if(12&o)for(var r=0,i=n.length;r<i;r++)Y(n[r],t);else 2===o&&Y(n,t)}else Y(e,t)}function Y(e,t){var n=e.props||T,o=e.dom;o.value=n.value,r(t)&&-1!==t.indexOf(n.value)||n.value===t?o.selected=!0:a(t)&&a(n.selected)||(o.selected=n.selected||!1)}Q.wrapped=!0;var J=H("onChange",Z);function Z(e,t,n,o){var r=Boolean(e.multiple);a(e.multiple)||r===t.multiple||(t.multiple=r);var i=o.childFlags;if(0==(1&i)){var s=o.children,l=e.value;if(n&&a(l)&&(l=e.defaultValue),12&i)for(var d=0,c=s.length;d<c;d++)G(s[d],l);else 2===i&&G(s,l)}}var ee=H("onInput",ne),te=H("onChange");function ne(e,t,n){var o=e.value,r=t.value;if(a(o)){if(n){var i=e.defaultValue;a(i)||i===r||(t.defaultValue=i,t.value=i)}}else r!==o&&(t.defaultValue=o,t.value=o)}function oe(e,t,n,o,r,i){64&e?z(o,n):256&e?Z(o,n,r,t):128&e&&ne(o,n,r),i&&(n.$V=t)}function re(e,t,n){64&e?function(e,t){q(t.type)?(e.onchange=X,e.onclick=Q):e.oninput=K}(t,n):256&e?function(e){e.onchange=J}(t):128&e&&function(e,t){e.oninput=ee,t.onChange&&(e.onchange=te)}(t,n)}function ie(e){return e.type&&q(e.type)?!a(e.checked):!a(e.value)}function ae(e,t){se(e),u(t)||(!function(e,t){e.removeChild(t)}(t,e.dom),e.dom=null)}function se(e){var t=e.flags;if(481&t){var n=e.ref,o=e.props;l(n)&&n(null);var r=e.children,i=e.childFlags;if(12&i?le(r):2===i&&se(r),!u(o))for(var s in o)switch(s){case"onClick":case"onDblClick":case"onFocusIn":case"onFocusOut":case"onKeyDown":case"onKeyPress":case"onKeyUp":case"onMouseDown":case"onMouseMove":case"onMouseUp":case"onSubmit":case"onTouchEnd":case"onTouchMove":case"onTouchStart":V(s,null,e.dom)}}else if(14&t){var d=e.children,c=e.ref;4&t?(l(w.beforeUnmount)&&w.beforeUnmount(e),l(d.componentWillUnmount)&&d.componentWillUnmount(),l(c)&&c(null),d.$UN=!0,se(d.$LI)):(!a(c)&&l(c.onComponentWillUnmount)&&c.onComponentWillUnmount(e.dom,e.props||T),se(d))}else if(1024&t){var p=e.children;u(p)||"object"!=typeof p||ae(p,e.type)}}function le(e){for(var t=0,n=e.length;t<n;t++)se(e[t])}function de(e,t){le(t),e.textContent=""}function ce(e,t){switch(e){case"animationIterationCount":case"borderImageOutset":case"borderImageSlice":case"borderImageWidth":case"boxFlex":case"boxFlexGroup":case"boxOrdinalGroup":case"columnCount":case"fillOpacity":case"flex":case"flexGrow":case"flexNegative":case"flexOrder":case"flexPositive":case"flexShrink":case"floodOpacity":case"fontWeight":case"gridColumn":case"gridRow":case"lineClamp":case"lineHeight":case"opacity":case"order":case"orphans":case"stopOpacity":case"strokeDasharray":case"strokeDashoffset":case"strokeMiterlimit":case"strokeOpacity":case"strokeWidth":case"tabSize":case"widows":case"zIndex":case"zoom":return t;default:return t+"px"}}function ue(e,t,n,o,r,i,s){switch(e){case"onClick":case"onDblClick":case"onFocusIn":case"onFocusOut":case"onKeyDown":case"onKeyPress":case"onKeyUp":case"onMouseDown":case"onMouseMove":case"onMouseUp":case"onSubmit":case"onTouchEnd":case"onTouchMove":case"onTouchStart":V(e,n,o);break;case"children":case"childrenType":case"className":case"defaultValue":case"key":case"multiple":case"ref":return;case"allowfullscreen":case"autoFocus":case"autoplay":case"capture":case"checked":case"controls":case"default":case"disabled":case"hidden":case"indeterminate":case"loop":case"muted":case"novalidate":case"open":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"selected":o[e="autoFocus"===e?e.toLowerCase():e]=!!n;break;case"defaultChecked":case"value":case"volume":if(i&&"value"===e)return;var p=a(n)?"":n;o[e]!==p&&(o[e]=p);break;case"dangerouslySetInnerHTML":var f=t&&t.__html||"",h=n&&n.__html||"";f!==h&&(a(h)||B(o,h)||(u(s)||(12&s.childFlags?le(s.children):2===s.childFlags&&se(s.children),s.children=null,s.childFlags=1),o.innerHTML=h));break;default:"o"===e[0]&&"n"===e[1]?function(e,t,n,o){var r=e.toLowerCase();if(l(n)||a(n)){var i=o[r];i&&i.wrapped||(o[r]=n)}else{var s=n.event;s&&l(s)&&(o[r]=function(e,t){return function(n){e(t.data,n)}}(s,n))}}(e,0,n,o):a(n)?o.removeAttribute(e):"style"===e?function(e,t,n){var o,r,i=n.style;if(d(t))i.cssText=t;else if(a(e)||d(e))for(o in t)r=t[o],i[o]=c(r)?ce(o,r):r;else{for(o in t)(r=t[o])!==e[o]&&(i[o]=c(r)?ce(o,r):r);for(o in e)a(t[o])&&(i[o]="")}}(t,n,o):r&&O[e]?o.setAttributeNS(O[e],e,n):o.setAttribute(e,n)}}function pe(e,t,n,o,r){var i=!1,a=(448&t)>0;for(var s in a&&(i=ie(n))&&re(t,o,n),n)ue(s,null,n[s],o,r,i,null);a&&oe(t,e,o,n,!0,i)}function fe(e,t,n,o){var r=new t(n,o);if(e.children=r,r.$V=e,r.$BS=!1,r.context=o,r.props===T&&(r.props=n),r.$UN=!1,l(r.componentWillMount)){if(r.$BR=!0,r.componentWillMount(),r.$PSS){var i=r.state,s=r.$PS;if(u(i))r.state=s;else for(var d in s)i[d]=s[d];r.$PSS=!1,r.$PS=null}r.$BR=!1}l(w.beforeRender)&&w.beforeRender(r);var c,p=he(r.render(n,r.state,o),e);return l(r.getChildContext)&&(c=r.getChildContext()),a(c)?r.$CX=o:r.$CX=h(o,c),l(w.afterRender)&&w.afterRender(r),r.$LI=p,r}function he(e,t){return s(e)?e=D():i(e)?e=b(e,null):(e.dom&&(e=C(e)),14&e.flags&&(e.parentVNode=t)),e}function ve(e,t,n,o,r){var i=e.flags;return 481&i?me(e,t,n,o,r):14&i?function(e,t,n,o,r,i){var a,s=e.type,l=e.props||T,d=e.ref;if(i){var c=fe(e,s,l,o);e.dom=a=ve(c.$LI,null,n,c.$CX,r),be(e,d,c,n),c.$UPD=!1}else{var p=he(s(l,o),e);e.children=p,e.dom=a=ve(p,null,n,o,r),ke(l,d,a,n)}u(t)||U(t,a);return a}(e,t,n,o,r,(4&i)>0):512&i||16&i?ge(e,t):1024&i?(ve(e.children,e.type,n,o,!1),e.dom=ge(D(),t)):void 0}function ge(e,t){var n=e.dom=document.createTextNode(e.children);return u(t)||U(t,n),n}function me(e,t,n,o,r){var i=e.flags,s=e.children,d=e.props,c=e.className,p=e.ref,f=e.childFlags;r=r||(32&i)>0;var h=function(e,t){return!0===t?document.createElementNS(P,e):document.createElement(e)}(e.type,r);if(e.dom=h,a(c)||""===c||(r?h.setAttribute("class",c):h.className=c),u(t)||U(t,h),0==(1&f)){var v=!0===r&&"foreignObject"!==e.type;2===f?ve(s,h,n,o,v):12&f&&ye(s,h,n,o,v)}return u(d)||pe(e,i,d,h,r),l(p)&&_e(h,p,n),h}function ye(e,t,n,o,r){for(var i=0,a=e.length;i<a;i++){var s=e[i];u(s.dom)||(e[i]=s=C(s)),ve(s,t,n,o,r)}}function be(e,t,n,o){l(t)&&t(n);var r=l(n.componentDidMount),i=w.afterMount,a=l(i);(r||a)&&o.push(function(e,t,n,o,r){return function(){e.$UPD=!0,t&&n(o),r&&e.componentDidMount(),e.$UPD=!1}}(n,a,i,e,r))}function ke(e,t,n,o){a(t)||(l(t.onComponentWillMount)&&t.onComponentWillMount(e),l(t.onComponentDidMount)&&o.push(function(e,t,n){return function(){return e.onComponentDidMount(t,n)}}(t,n,e)))}function _e(e,t,n){n.push(function(){return t(e)})}function Ce(e,t,n,o,r){var i=e.children,s=e.props,d=e.className,c=e.flags,p=e.ref;if(r=r||(32&c)>0,1!==t.nodeType||t.tagName.toLowerCase()!==e.type){var f=me(e,null,n,o,r);e.dom=f,E(t.parentNode,f,t)}else{e.dom=t;var h=t.firstChild,v=e.childFlags;if(0==(1&v)){for(var g=null;h;)g=h.nextSibling,8===h.nodeType&&("!"===h.data?t.replaceChild(document.createTextNode(""),h):t.removeChild(h)),h=g;if(h=t.firstChild,2===v)u(h)?ve(i,t,n,o,r):(g=h.nextSibling,De(i,h,n,o,r),h=g);else if(12&v)for(var m=0,y=i.length;m<y;m++){var b=i[m];u(h)?ve(b,t,n,o,r):(g=h.nextSibling,De(b,h,n,o,r),h=g)}for(;h;)g=h.nextSibling,t.removeChild(h),h=g}else u(t.firstChild)||function(e,t){return Boolean(t&&t.dangerouslySetInnerHTML&&t.dangerouslySetInnerHTML.__html&&B(e,t.dangerouslySetInnerHTML.__html))}(t,s)||(t.textContent="",448&c&&(t.defaultValue=""));u(s)||pe(e,c,s,t,r),a(d)?""!==t.className&&t.removeAttribute("class"):r?t.setAttribute("class",d):t.className=d,l(p)&&_e(t,p,n)}}function De(e,t,n,r,i){var a=e.flags;14&a?function(e,t,n,o,r,i){var a=e.type,s=e.ref,l=e.props||T;if(i){var d=fe(e,a,l,o),c=d.$LI;De(c,t,n,d.$CX,r),e.dom=c.dom,be(e,s,d,n),d.$UPD=!1}else{var u=he(a(l,o),e);De(u,t,n,o,r),e.children=u,e.dom=u.dom,ke(l,s,t,n)}}(e,t,n,r,i,(4&a)>0):481&a?Ce(e,t,n,r,i):16&a?function(e,t){if(3!==t.nodeType){var n=ge(e,null);e.dom=n,E(t.parentNode,n,t)}else{var o=e.children;t.nodeValue!==o&&(t.nodeValue=o),e.dom=t}}(e,t):512&a?e.dom=t:function(e){throw e||(e=o),new Error("Inferno Error: "+e)}()}function $e(e,t,n,o,r,i){se(e),E(n,ve(t,null,o,r,i),e.dom)}function xe(e,t,o,r,i,d){if(e!==t){var c=0|t.flags;e.flags!==c||2048&c?$e(e,t,o,r,i,d):481&c?function(e,t,n,o,r,i){var s=t.type;if(e.type!==s)$e(e,t,n,o,r,i);else{var d,c=e.dom,u=t.flags,p=e.props,f=t.props,h=!1,v=!1;if(t.dom=c,i=i||(32&u)>0,p!==f){var g=p||T;if((d=f||T)!==T)for(var m in(h=(448&u)>0)&&(v=ie(d)),d){var y=g[m],b=d[m];y!==b&&ue(m,y,b,c,i,v,e)}if(g!==T)for(var k in g)d.hasOwnProperty(k)||a(g[k])||ue(k,g[k],null,c,i,v,e)}var _=e.children,C=t.children,D=t.ref,$=e.className,x=t.className;_!==C&&we(e.childFlags,t.childFlags,_,C,c,o,r,i&&"foreignObject"!==s),h&&oe(u,t,c,d,!1,v),$!==x&&(a(x)?c.removeAttribute("class"):i?c.setAttribute("class",x):c.className=x),l(D)&&e.ref!==D&&_e(c,D,o)}}(e,t,o,r,i,d):14&c?function(e,t,o,r,i,s,d){var c=t.type,u=e.key,p=t.key;if(e.type!==c||u!==p)$e(e,t,o,r,i,s);else{var f=t.props||T;if(d){var h=e.children;h.$UPD=!0,Ne(h,h.state,t,f,o,r,i,s,!1,!1),h.$V=t,h.$UPD=!1}else{var v=!0,g=e.props,m=t.ref,y=!a(m),b=e.children;if(t.dom=e.dom,t.children=b,y&&l(m.onComponentShouldUpdate)&&(v=m.onComponentShouldUpdate(g,f)),!1!==v){y&&l(m.onComponentWillUpdate)&&m.onComponentWillUpdate(g,f);var k=c(f,i);k!==n&&(k=he(k,t),xe(b,k,o,r,i,s),t.children=k,t.dom=k.dom,y&&l(m.onComponentDidUpdate)&&m.onComponentDidUpdate(g,f))}else 14&b.flags&&(b.parentVNode=t)}}}(e,t,o,r,i,d,(4&c)>0):16&c?function(e,t,n){var o,r=t.children;u(n.firstChild)?(n.textContent=r,o=n.firstChild):(o=e.dom,r!==e.children&&(o.nodeValue=r));t.dom=o}(e,t,o):512&c?t.dom=e.dom:function(e,t,n,o){var r=e.type,i=t.type,a=t.children;if(we(e.childFlags,t.childFlags,e.children,a,r,n,o,!1),t.dom=e.dom,r!==i&&!s(a)){var l=a.dom;r.removeChild(l),i.appendChild(l)}}(e,t,r,i)}}function we(e,t,n,o,r,i,a,s){switch(e){case 2:switch(t){case 2:xe(n,o,r,i,a,s);break;case 1:ae(n,r);break;default:ae(n,r),ye(o,r,i,a,s)}break;case 1:switch(t){case 2:ve(o,r,i,a,s);break;case 1:break;default:ye(o,r,i,a,s)}break;default:if(12&t){var l=n.length,d=o.length;0===l?d>0&&ye(o,r,i,a,s):0===d?de(r,n):8===t&&8===e?function(e,t,n,o,r,i,a,s){var l,d,c,p,h,v,g,m=a-1,y=s-1,b=0,k=0,_=e[b],D=t[k],$=e[m],x=t[y];D.dom&&(t[k]=D=C(D));x.dom&&(t[y]=x=C(x));e:{for(;_.key===D.key;){if(xe(_,D,n,o,r,i),k++,++b>m||k>y)break e;_=e[b],(D=t[k]).dom&&(t[k]=D=C(D))}for(;$.key===x.key;){if(xe($,x,n,o,r,i),y--,b>--m||k>y)break e;$=e[m],(x=t[y]).dom&&(t[y]=x=C(x))}}if(b>m){if(k<=y)for(h=(v=y+1)<s?t[v].dom:null;k<=y;)(g=t[k]).dom&&(t[k]=g=C(g)),k++,M(n,ve(g,null,o,r,i),h)}else if(k>y)for(;b<=m;)ae(e[b++],n);else{var w=m-b+1,N=y-k+1,S=new Array(N);for(l=0;l<N;l++)S[l]=-1;var P=!1,O=0,T=0;if(N<=4||w*N<=16){for(l=b;l<=m;l++)if(c=e[l],T<N)for(d=k;d<=y;d++)if(p=t[d],c.key===p.key){S[d-k]=l,O>d?P=!0:O=d,p.dom&&(t[d]=p=C(p)),xe(c,p,n,o,r,i),T++,e[l]=null;break}}else{var L={};for(l=k;l<=y;l++)L[t[l].key]=l;for(l=b;l<=m;l++)c=e[l],T<N&&f(d=L[c.key])&&(p=t[d],S[d-k]=l,O>d?P=!0:O=d,p.dom&&(t[d]=p=C(p)),xe(c,p,n,o,r,i),T++,e[l]=null)}if(w===a&&0===T)de(n,e),ye(t,n,o,r,i);else{for(l=w-T;l>0;)u(c=e[b++])||(ae(c,n),l--);if(P){var U=function(e){var t,n,o,r,i,a=e.slice(),s=[0],l=e.length;for(t=0;t<l;t++){var d=e[t];if(-1!==d){if(n=s[s.length-1],e[n]<d){a[t]=n,s.push(t);continue}for(o=0,r=s.length-1;o<r;)e[s[i=(o+r)/2|0]]<d?o=i+1:r=i;d<e[s[o]]&&(o>0&&(a[t]=s[o-1]),s[o]=t)}}o=s.length,r=s[o-1];for(;o-- >0;)s[o]=r,r=a[r];return s}(S);for(d=U.length-1,l=N-1;l>=0;l--)-1===S[l]?((g=t[O=l+k]).dom&&(t[O]=g=C(g)),v=O+1,M(n,ve(g,null,o,r,i),v<s?t[v].dom:null)):d<0||l!==U[d]?(g=t[O=l+k],v=O+1,M(n,g.dom,v<s?t[v].dom:null)):d--}else if(T!==N)for(l=N-1;l>=0;l--)-1===S[l]&&((g=t[O=l+k]).dom&&(t[O]=g=C(g)),v=O+1,M(n,ve(g,null,o,r,i),v<s?t[v].dom:null))}}}(n,o,r,i,a,s,l,d):function(e,t,n,o,r,i,a,s){for(var l=a>s?s:a,d=0;d<l;d++){var c=t[d];c.dom&&(c=t[d]=C(c)),xe(e[d],c,n,o,r,i)}if(a<s)for(d=l;d<s;d++){var u=t[d];u.dom&&(u=t[d]=C(u)),ve(u,n,o,r,i)}else if(a>s)for(d=l;d<a;d++)ae(e[d],n)}(n,o,r,i,a,s,l,d)}else 1===t?de(r,n):(de(r,n),ve(o,r,i,a,s))}}function Ne(e,t,o,r,i,s,d,c,u,p){var f=e.state,v=e.props;o.children=e;var g,m=e.$LI;if(!e.$UN){if(v!==r||r===T){if(!p&&l(e.componentWillReceiveProps)){if(e.$BR=!0,e.componentWillReceiveProps(r,d),e.$UN)return;e.$BR=!1}e.$PSS&&(t=h(t,e.$PS),e.$PSS=!1,e.$PS=null)}var y=l(e.shouldComponentUpdate);if(u||!y||y&&e.shouldComponentUpdate(r,t,d)){l(e.componentWillUpdate)&&(e.$BS=!0,e.componentWillUpdate(r,t,d),e.$BS=!1),e.props=r,e.state=t,e.context=d,l(w.beforeRender)&&w.beforeRender(e),g=e.render(r,t,d),l(w.afterRender)&&w.afterRender(e);var b,k=g!==n;if(l(e.getChildContext)&&(b=e.getChildContext()),b=a(b)?d:h(d,b),e.$CX=b,k)xe(m,e.$LI=he(g,o),i,s,b,c),l(e.componentDidUpdate)&&e.componentDidUpdate(v,f),l(w.afterUpdate)&&w.afterUpdate(o)}else e.props=r,e.state=t,e.context=d;o.dom=e.$LI.dom}}var Se=w.roots;function Pe(e,t,o){if(e!==n){var r,i,d=Se.length;for(i=0;i<d;i++)if(Se[i]===t){r=t.$V;break}return p(r)?s(e)||(e.dom&&(e=C(e)),u(t.firstChild)?(ve(e,t,L,T,!1),t.$V=e,Se.push(t)):function(e,t,n){var o=t.firstChild;if(!u(o))for(s(e)||De(e,o,L,T,!1),o=t.firstChild;o=o.nextSibling;)t.removeChild(o);L.length>0&&I(L),t.$V||w.roots.push(t),t.$V=e,l(n)&&n()}(e,t),r=e):a(e)?(ae(r,t),Se.splice(i,1)):(e.dom&&(e=C(e)),xe(r,e,t,L,T,!1),r=t.$V=e),L.length>0&&I(L),l(o)&&o(),r&&14&r.flags?r.children:void 0}}var Oe="undefined"==typeof Promise?null:Promise.resolve(),Te="undefined"==typeof requestAnimationFrame?setTimeout:requestAnimationFrame;function Le(e,t,n){l(t)&&(t=t(e.state,e.props,e.context));var o,r=e.$PS;if(a(r))e.$PS=t;else for(var i in t)r[i]=t[i];if(e.$PSS||e.$BR)e.$PSS=!0,e.$BR&&l(n)&&L.push(n.bind(e));else if(e.$UPD){var s=e.$QU;u(s)&&(s=e.$QU=[],o=function(e,t){return function(){e.$QU=null,e.$UPD=!0,Ue(e,!1,function(){for(var n=0,o=t.length;n<o;n++)t[n].call(e)}),e.$UPD=!1}}(e,s),Oe?Oe.then(o):Te(o)),l(n)&&s.push(n)}else e.$PSS=!0,e.$UPD=!0,Ue(e,!1,n),e.$UPD=!1}function Ue(e,t,n){if(!e.$UN){if(t||!e.$BR){e.$PSS=!1;var o=e.$PS,r=h(e.state,o),i=e.props,a=e.context;e.$PS=null;var s=e.$V,d=e.$LI;if(Ne(e,r,s,i,d.dom&&d.dom.parentNode,L,a,(32&s.flags)>0,t,!0),e.$UN)return;if(0==(1024&e.$LI.flags))for(var c=e.$LI.dom;!u(s=s.parentVNode);)(14&s.flags)>0&&(s.dom=c);L.length>0&&I(L)}else e.state=e.$PS,e.$PS=null;l(n)&&n.call(e)}}var Me=function(e,t){this.state=null,this.$BR=!1,this.$BS=!0,this.$PSS=!1,this.$PS=null,this.$LI=null,this.$V=null,this.$UN=!1,this.$CX=null,this.$UPD=!0,this.$QU=null,this.props=e||T,this.context=t||T};Me.prototype.forceUpdate=function(e){this.$UN||Ue(this,!0,e)},Me.prototype.setState=function(e,t){this.$UN||this.$BS||Le(this,e,t)},Me.prototype.render=function(e,t,n){},Me.defaultProps=null;var Ee=12,Ie=37,Fe=38,Ae=39,Ve=40;var je=Me,Re=(function(){function e(e){this.value=e}function t(t){var n,o;function r(n,o){try{var a=t[n](o),s=a.value;s instanceof e?Promise.resolve(s.value).then(function(e){r("next",e)},function(e){r("throw",e)}):i(a.done?"return":"normal",a.value)}catch(e){i("throw",e)}}function i(e,t){switch(e){case"return":n.resolve({value:t,done:!0});break;case"throw":n.reject(t);break;default:n.resolve({value:t,done:!1})}(n=n.next)?r(n.key,n.arg):o=null}this._invoke=function(e,t){return new Promise(function(i,a){var s={key:e,arg:t,resolve:i,reject:a,next:null};o?o=o.next=s:(n=o=s,r(e,t))})},"function"!=typeof t.return&&(this.return=void 0)}"function"==typeof Symbol&&Symbol.asyncIterator&&(t.prototype[Symbol.asyncIterator]=function(){return this}),t.prototype.next=function(e){return this._invoke("next",e)},t.prototype.throw=function(e){return this._invoke("throw",e)},t.prototype.return=function(e){return this._invoke("return",e)}}(),function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}),Be=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),We=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},He=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},qe=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},Ke=function(e){function t(){return Re(this,t),qe(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return He(t,je),Be(t,[{key:"click",value:function(e){var t=this,n=function(){t.props.node.toggleCheck()};this.props.dom._tree.emit("node.click",e,this.props.node,n),e.treeDefaultPrevented||n()}},{key:"render",value:function(){return m(64,"input",null,null,1,{checked:this.props.node.checked(),indeterminate:this.props.indeterminate,onClick:this.click.bind(this),type:"checkbox"})}}]),t}(),Xe=function(e){function t(){return Re(this,t),qe(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return He(t,je),Be(t,[{key:"render",value:function(){return m(1,"i","leaf-icon "+this.props.iconClass)}}]),t}(),Qe=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"li",o=t.itree[n].attributes,r=[],i=o.class||o.className;return e.isFunction(i)&&(i=i(t)),e.isEmpty(i)||(e.isString(i)?r=r.concat(i.split(/[\s\.]+/)):e.isArray(i)&&(r=r.concat(i))),r},ze=function(e){function t(){return Re(this,t),qe(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return He(t,je),Be(t,[{key:"shouldComponentUpdate",value:function(){return!1}},{key:"add",value:function(e){e.stopPropagation(),this.props.node.addChild({text:"New Node",itree:{state:{editing:!0,focused:!0}}}),this.props.node.expand()}},{key:"edit",value:function(e){e.stopPropagation(),this.props.node.toggleEditing()}},{key:"remove",value:function(e){e.stopPropagation(),this.props.node.remove()}},{key:"render",value:function(){var e=[];return this.props.dom._tree.config.editing.edit&&e.push(m(1,"a","btn icon icon-pencil",null,1,{onclick:this.edit.bind(this),title:"Edit this node"})),this.props.dom._tree.config.editing.add&&e.push(m(1,"a","btn icon icon-plus",null,1,{onclick:this.add.bind(this),title:"Add a child node"})),this.props.dom._tree.config.editing.remove&&e.push(m(1,"a","btn icon icon-minus",null,1,{onclick:this.remove.bind(this),title:"Remove this node"})),m(1,"span","btn-group",e,0)}}]),t}(),Ge=function(e){function t(){return Re(this,t),qe(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return He(t,je),Be(t,[{key:"render",value:function(){return m(1,"ol",null,m(1,"li","leaf",m(1,"span","title icon icon-file-empty empty",this.props.text,0),2),2)}}]),t}();function Ye(t,n){var o=n.dirty||!1;return o||e.each(Object.keys(n),function(e){if("dirty"!==e&&n[e]!==t[e])return o=!0,!1}),o}var Je=function(e){function t(e){Re(this,t);var n=qe(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state=n.getStateFromNodes(e.node),n}return He(t,je),Be(t,[{key:"getStateFromNodes",value:function(e){return{text:e.text}}},{key:"componentWillReceiveProps",value:function(e){this.setState(this.getStateFromNodes(e.node))}},{key:"shouldComponentUpdate",value:function(e,t){return Ye(this.state,t)}},{key:"click",value:function(e){var t=this,n=function(){t.props.node.toggleCheck()};this.props.dom._tree.emit("node.click",e,this.props.node,n),e.treeDefaultPrevented||n()}},{key:"keypress",value:function(e){if(e.which===Ee)return this.save()}},{key:"input",value:function(e){this.setState({text:e.target.value})}},{key:"cancel",value:function(e){e&&e.stopPropagation(),this.props.node.toggleEditing()}},{key:"save",value:function(e){e&&e.stopPropagation();var t=this.props.node.text,n=this.ref.value;this.props.node.set("text",n),this.props.node.state("editing",!1),this.props.node.markDirty(),this.props.dom._tree.applyChanges(),t!==n&&this.props.dom._tree.emit("node.edited",this.props.node,t,n)}},{key:"render",value:function(){var e=this;return m(1,"form",null,[m(64,"input",null,null,1,{onClick:function(e){return e.stopPropagation},onInput:this.input.bind(this),onKeyPress:this.keypress.bind(this),value:this.state.text},null,function(t){return e.ref=t}),m(1,"span","btn-group",[m(1,"button","btn icon icon-check",null,1,{onClick:this.save.bind(this),title:"Save",type:"button"}),m(1,"button","btn icon icon-cross",null,1,{onClick:this.cancel.bind(this),title:"Cancel",type:"button"})],4)],4,{onsubmit:function(e){return e.preventDefault}})}}]),t}(),Ze=function(e){function t(){return Re(this,t),qe(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return He(t,je),Be(t,[{key:"blur",value:function(){this.props.node.blur()}},{key:"click",value:function(e){var t=this,n=this.props,o=n.node,r=n.dom,i=function(){if(e.preventDefault(),!t.props.editing){if((e.metaKey||e.ctrlKey||e.shiftKey)&&r._tree.disableDeselection(),e.shiftKey){r.clearSelection();var n=r._tree.lastSelectedNode();n&&r._tree.selectBetween.apply(r._tree,r._tree.boundingNodes(n,o))}o.selected()?r._tree.config.selection.disableDirectDeselection||o.deselect():o.select(),r._tree.enableDeselection()}};r._tree.emit("node.click",e,o,i),e.treeDefaultPrevented||i()}},{key:"contextMenu",value:function(e){var t=this.props,n=t.node;t.dom._tree.emit("node.contextmenu",e,n)}},{key:"dblclick",value:function(e){var t=this.props,n=t.node,o=t.dom,r=function(){o.clearSelection(),n.toggleCollapse()};o._tree.emit("node.dblclick",e,n,r),e.treeDefaultPrevented||r()}},{key:"focus",value:function(e){this.props.node.focus(e)}},{key:"mousedown",value:function(){this.props.dom.isDragDropEnabled&&(this.props.dom.isMouseHeld=!0)}},{key:"render",value:function(){var e=this.props.node,t=_.clone(e.itree.a.attributes)||{};t.tabindex=1,t.unselectable="on";var n=Qe(e,"a").concat(["title","icon"]);if(!this.props.dom.config.showCheckboxes){var o=this.props.expanded?"icon-folder-open":"icon-folder";n.push(e.itree.icon||(this.props.hasOrWillHaveChildren?o:"icon-file-empty"))}t.class=t.className=n.join(" ");var r=e.text;return e.editing()&&(r=y(2,Je,{dom:this.props.dom,node:this.props.node})),k(m(1,"a",null,r,0,We({"data-uid":e.id,onBlur:this.blur.bind(this),onClick:this.click.bind(this),onContextMenu:this.contextMenu.bind(this),onDblClick:this.dblclick.bind(this),onFocus:this.focus.bind(this),onMouseDown:this.mousedown.bind(this)},t)))}}]),t}(),et=function(e){function t(){return Re(this,t),qe(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return He(t,je),Be(t,[{key:"className",value:function(){return"toggle icon "+(this.props.collapsed?"icon-expand":"icon-collapse")}},{key:"render",value:function(){return m(1,"a",this.className(),null,1,{onClick:this.props.node.toggleCollapse.bind(this.props.node)})}}]),t}(),tt=function(e){function n(e){Re(this,n);var t=qe(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e));return t.state=t.stateFromNode(e.node),t}return He(n,je),Be(n,[{key:"stateFromNode",value:function(e){return{dirty:e.itree.dirty}}},{key:"componentWillReceiveProps",value:function(e){this.setState(this.stateFromNode(e.node))}},{key:"shouldComponentUpdate",value:function(e,t){return t.dirty}},{key:"getAttributes",value:function(){var e=this.props.node,t=_.clone(e.itree.li.attributes)||{};return t.class=t.className=this.getClassNames(),t["data-uid"]=e.id,this.props.dom.config.dragAndDrop.enabled&&(t.draggable=e.state("draggable"),t.onDragEnd=this.onDragEnd.bind(this),t.onDragEnter=this.onDragEnter.bind(this),t.onDragLeave=this.onDragLeave.bind(this),t.onDragStart=this.onDragStart.bind(this),e.state("drop-target")?(t.onDragOver=this.onDragOver.bind(this),t.onDrop=this.onDrop.bind(this)):(t.onDragOver=null,t.onDrop=null)),t}},{key:"getClassNames",value:function(){var e=this.props.node,t=e.itree.state,n=Qe(e);return _.each(Object.keys(t),function(e){t[e]&&n.push(e)}),!e.hidden()&&e.removed()&&n.push("hidden"),e.expanded()&&n.push("expanded"),n.push(e.hasOrWillHaveChildren()?"folder":"leaf"),n.join(" ")}},{key:"getTargetDirection",value:function(e,t){var n=e.clientY,o=t.getBoundingClientRect(),r=o.top+o.height/3,i=o.bottom-o.height/3,a=0;return n<=r?a=-1:n>=i&&(a=1),a}},{key:"onDragStart",value:function(e){e.stopPropagation(),e.dataTransfer.effectAllowed="move",e.dataTransfer.dropEffect="move";var n=this.props.node;if(this.props.dom._activeDragNode=n,e.dataTransfer.setData("treeId",n.tree().id),e.dataTransfer.setData("nodeId",n.id),n.state("drop-target",!1),n.hasChildren()&&n.children.stateDeep("drop-target",!1),"dragstart"===this.props.dom.config.dragAndDrop.validateOn){var o=this.props.dom.config.dragAndDrop.validate,r=_.isFunction(o);this.props.dom._tree.batch(),function e(n,o){t.isTreeNodes(n)?_.each(n,function(t){e(t,o)}):t.isTreeNode(n)&&!1!==o(n)&&n.hasChildren()&&e(n.children,o)}(this.props.dom._tree.model,function(e){var t=e.id!==n.id;return t&&(t=!e.hasAncestor(n)),t&&r&&(t=o(n,e)),e.state("drop-target",t),t}),this.props.dom._tree.end()}this.props.dom._tree.emit("node.dragstart",e)}},{key:"onDragEnd",value:function(e){e.preventDefault(),e.stopPropagation(),this.unhighlightTarget(),this.props.dom._tree.emit("node.dragend",e)}},{key:"onDragEnter",value:function(e){e.preventDefault(),e.stopPropagation(),this.props.node.recurseUp(this.unhighlightTarget),this.props.node.state("drag-targeting",!0),this.props.dom._tree.emit("node.dragenter",e)}},{key:"onDragLeave",value:function(e){e.preventDefault(),e.stopPropagation(),this.unhighlightTarget(),this.props.dom._tree.emit("node.dragleave",e)}},{key:"onDragOver",value:function(e){e.preventDefault(),e.stopPropagation();var t=this.props.dom._activeDragNode,n=this.props.node,o=this.getTargetDirection(e,n.itree.ref.querySelector("a"));if("dragover"===this.props.dom.config.dragAndDrop.validateOn){var r=this.props.dom.config.dragAndDrop.validate,i=_.isFunction(r),a=t.id!==n.id;if(a&&(a=!n.hasAncestor(t)),a&&i&&(a=r(t,n,o)),n.state("drop-target",a),this.props.dom._tree.applyChanges(),!a)return}this.props.dom._tree.batch(),n.state("drag-targeting",!0),n.state("drag-targeting-above",-1===o),n.state("drag-targeting-below",1===o),n.state("drag-targeting-insert",0===o),this.props.dom._tree.end(),this.props.dom._tree.emit("node.dragover",e,o)}},{key:"onDrop",value:function(e){e.preventDefault(),e.stopPropagation(),this.unhighlightTarget();var t=e.dataTransfer.getData("treeId"),n=e.dataTransfer.getData("nodeId"),o=this.props.node;this.props.dom._activeDragNode=null;var r=this.getTargetDirection(e,e.target),i=(t===this.props.dom._tree.id?this.props.dom._tree:document.querySelector('[data-uid="'+t+'"]').inspireTree).node(n);i.state("drop-target",!0);var a=i.remove(!0),s=o.context().indexOf(o),l=void 0,d=void 0;0===r?(l=o.addChild(a),d=o.children.indexOf(l),o.expand()):(d=1===r?++s:s,l=o.context().insertAt(d,a)),this.props.dom._tree.emit("node.drop",e,l,o,d)}},{key:"unhighlightTarget",value:function(e){(e||this.props.node).states(["drag-targeting","drag-targeting-above","drag-targeting-below","drag-targeting-insert"],!1)}},{key:"renderCheckbox",value:function(){var e=this.props.node;if(this.props.dom.config.showCheckboxes)return y(2,Ke,{checked:e.checked(),dom:this.props.dom,indeterminate:e.indeterminate(),node:e})}},{key:"renderIcon",value:function(){var e=this.props.node,t=e.class||e.className,n=t?t.join(" "):"";return y(2,Xe,{iconClass:n})}},{key:"renderChildren",value:function(){var e=this.props,t=e.node,n=e.dom;if(t.hasChildren()){var o=t.children,r=n.loading,i=o.pagination();return y(2,nt,{context:t,dom:n,limit:i.limit,loading:r,nodes:o,total:i.total})}if(this.props.dom.isDynamic&&t.children)return t.hasLoadedChildren()?y(2,Ge,{text:"No Results"}):y(2,Ge,{text:"Loading..."})}},{key:"renderEditToolbar",value:function(){if(this.props.dom._tree.config.editing.edit&&!this.props.node.editing())return y(2,ze,{dom:this.props.dom,node:this.props.node})}},{key:"renderToggle",value:function(){var e=this.props.node;if(this.props.dom.isDynamic?Boolean(e.children):e.hasVisibleChildren())return y(2,et,{collapsed:e.collapsed(),node:e})}},{key:"render",value:function(){var e=this,t=this.props.node,n=k(m(1,"li",null,[this.renderEditToolbar(),m(1,"div","title-wrap",[this.renderToggle(),this.renderCheckbox(),this.renderIcon(),y(2,Ze,{dom:this.props.dom,editing:t.editing(),expanded:t.expanded(),hasOrWillHaveChildren:t.hasOrWillHaveChildren(),node:t,text:t.text})],0),m(1,"div","wholerow"),this.renderChildren()],0,We({},this.getAttributes()),null,function(t){return e.node=e.props.node.itree.ref=t}));return this.props.node.state("rendered",!0),this.props.node.itree.dirty=!1,n}}]),n}(),nt=function(e){function t(){return Re(this,t),qe(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return He(t,je),Be(t,[{key:"shouldComponentUpdate",value:function(e){return _.find(e.nodes,"itree.dirty")||Ye(this.props,e)}},{key:"isDeferred",value:function(){return this.props.dom.config.deferredRendering||this.props.dom._tree.config.deferredLoading}},{key:"loadMore",value:function(e){e.preventDefault(),this.props.context?this.props.context.loadMore(e):this.props.dom._tree.loadMore(e)}},{key:"renderLoadMoreNode",value:function(){return m(1,"li","leaf detached",m(1,"a","title icon icon-more load-more",b("Load More"),2,{onClick:this.loadMore.bind(this)}),2)}},{key:"renderLoadingTextNode",value:function(){return m(1,"li","leaf",m(1,"span","title icon icon-more",b("Loading..."),2),2)}},{key:"render",value:function(){var e=this,t=this.props.nodes,n=t.pagination();if(this.props.dom.config.deferredRendering){var o=0;t=this.props.nodes.filter(function(e){var t=!(e.hidden()||e.removed());return t&&o++,o<=n.limit&&t})}var r=_.map(t,function(t){return y(2,tt,{dom:e.props.dom,node:t},t.id)});return this.isDeferred()&&n.limit<n.total&&(this.props.loading?r.push(this.renderLoadingTextNode()):r.push(this.renderLoadMoreNode())),m(1,"ol",null,[r,this.props.children],0)}}]),t}(),ot=function(e){function t(){return Re(this,t),qe(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return He(t,je),Be(t,[{key:"add",value:function(){this.props.dom._tree.focused().blur(),this.props.dom._tree.addNode({text:"New Node",itree:{state:{editing:!0,focused:!0}}})}},{key:"renderAddLink",value:function(){if(this.props.dom._tree.config.editing.add)return m(1,"li",null,m(1,"a","btn icon icon-plus",null,1,{onClick:this.add.bind(this),title:"Add a new root node"}),2)}},{key:"render",value:function(){var e=this.props,t=e.dom,n=e.nodes,o=t.loading,r=n.pagination();return y(2,nt,{dom:t,limit:r.limit,loading:o,nodes:n,total:r.total,children:this.renderAddLink()})}}]),t}();return function(){function n(o,r){var i=this;if(Re(this,n),!(o instanceof t))throw new TypeError("Tree argument is not an InspireTree instance.");if(this._tree=o,this.batching=0,this.dropTargets=[],this.$scrollLayer,!r.target)throw new TypeError("Invalid `target` property - must be a selector, HTMLElement, or jQuery element.");o.usesNativeDOM=!0;var a={enabled:!1,validateOn:"dragstart",validate:null};this.config=e.defaultsDeep({},r,{autoLoadMore:!0,deferredRendering:!1,dragAndDrop:a,nodeHeight:25,showCheckboxes:!1,tabindex:-1,target:!1}),!0===r.dragAndDrop&&(this.config.dragAndDrop=a,this.config.dragAndDrop.enabled=!0),"checkbox"!==o.config.selection.mode||e.isBoolean(e.get(r,"showCheckboxes"))||(this.config.showCheckboxes=!0),this.isDynamic=e.isFunction(this._tree.config.data),this.attach(this.config.target);var s=!0;o.on("changes.applied",function(){i.renderNodes(),s&&(i.scrollSelectedIntoView(),s=!1)}),this.renderNodes()}return Be(n,[{key:"attach",value:function(t){if(this.$target=this.getElement(t),this.$scrollLayer=this.getScrollableAncestor(this.$target),!this.$target)throw new Error("No valid element to attach to.");this.$target.setAttribute("data-uid",this._tree.id);var n=this.$target.className.split(" ");if(n.push("inspire-tree"),this._tree.config.editable&&(n.push("editable"),e.each(e.pickBy(this._tree.config.editing,e.identity),function(e,t){n.push("editable-"+t)})),this.$target.className=n.join(" "),this.$target.setAttribute("tabindex",this.config.tabindex||0),this.$target.addEventListener("keydown",this.keyboardListener.bind(this)),this.config.dragAndDrop.enabled&&(this.$target.addEventListener("dragenter",this.onDragEnter.bind(this),!1),this.$target.addEventListener("dragleave",this.onDragLeave.bind(this),!1),this.$target.addEventListener("dragover",this.onDragOver.bind(this),!1),this.$target.addEventListener("drop",this.onDrop.bind(this),!1),this.$target.classList.add("drag-and-drop")),this._tree.on("node.focused",function(e){var t=e.itree.ref.querySelector(".title");t!==document.activeElement&&t.focus()}),this.config.deferredRendering||this._tree.config.deferredLoading){var o=this._tree.config.pagination.limit;this._tree.config.pagination.limit=o>0?o:e.ceil(this.$scrollLayer.clientHeight/this.config.nodeHeight),this.config.autoLoadMore&&this.$target.addEventListener("scroll",e.throttle(this.scrollListener.bind(this),20))}this.$target.inspireTree=this._tree}},{key:"clearSelection",value:function(){document.selection&&document.selection.empty?document.selection.empty():window.getSelection&&window.getSelection().removeAllRanges()}},{key:"getElement",value:function(t){var n=void 0;if(t instanceof HTMLElement)n=t;else if(e.isObject(t)&&e.isObject(t[0]))n=t[0];else if(e.isString(t)){var o=document.querySelector(t);o&&(n=o)}return n}},{key:"getScrollableAncestor",value:function(e){e instanceof Element&&("auto"!==getComputedStyle(e).overflow&&e.parentNode&&(e=this.getScrollableAncestor(e.parentNode)));return e}},{key:"keyboardListener",value:function(e){if(e.stopPropagation(),!([Ve,Ee,Ie,Ae,Fe].indexOf(e.which)<0)){var t=this._tree.focused();if(t.length)switch(e.preventDefault(),e.which){case Ve:this.moveFocusDownFrom(t[0]);break;case Ee:t[0].toggleSelect();break;case Ie:t[0].collapse();break;case Ae:t[0].expand();break;case Fe:this.moveFocusUpFrom(t[0])}}}},{key:"moveFocusDownFrom",value:function(e){var t=e.nextVisibleNode();t&&t.focus()}},{key:"moveFocusUpFrom",value:function(e){var t=e.previousVisibleNode();t&&t.focus()}},{key:"nodeFromTitleDOMElement",value:function(e){var t=e.parentNode.parentNode.getAttribute("data-uid");return this._tree.node(t)}},{key:"onDragEnter",value:function(e){e.preventDefault(),e.target.classList.add("drag-targeting","drag-targeting-insert")}},{key:"onDragLeave",value:function(e){e.preventDefault(),this.unhighlightTarget(e.target)}},{key:"onDragOver",value:function(e){e.preventDefault()}},{key:"onDrop",value:function(e){e.preventDefault(),this.unhighlightTarget(e.target);var t=e.dataTransfer.getData("treeId"),o=e.dataTransfer.getData("nodeId"),r=n.getTreeById(t).node(o);r.state("drop-target",!0);var i=r.remove(!0),a=this._tree.addNode(i),s=this._tree.indexOf(a);this._tree.emit("node.drop",e,a,null,s)}},{key:"renderNodes",value:function(e){Pe(y(2,ot,{dom:this,nodes:e||this._tree.nodes()}),this.$target)}},{key:"scrollListener",value:function(t){var n=this;if(!this.rendering&&!this.loading){var o=this.$scrollLayer.getBoundingClientRect(),r=document.querySelectorAll(".load-more");e.each(r,function(e){var r=e.getBoundingClientRect();if(!(o.right<r.left||o.left>r.right||o.bottom<r.top||o.top>r.bottom)){var i=void 0,a=e.parentNode.parentNode.parentNode;"LI"===a.tagName&&(i=n._tree.node(a.getAttribute("data-uid"))),n._tree.loadMore(i,t)}})}}},{key:"scrollSelectedIntoView",value:function(){var e=this.$target.querySelector(".selected");e&&this.$scrollLayer&&(this.$scrollLayer.scrollTop=e.offsetTop)}},{key:"unhighlightTarget",value:function(e){e&&e.classList.remove("drag-targeting","drag-targeting-insert")}}],[{key:"getTreeById",value:function(e){var t=document.querySelector('[data-uid="'+e+'"]');if(t)return t.inspireTree}}]),n}()});
